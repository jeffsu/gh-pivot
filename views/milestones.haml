.row-fluid
  .span9
    %table.table-bordered.table.table-condensed
      %thead
        %tr
          %th Number
          %th Title
          %th Labels
          %th Assignee
          %th Status
      - @milestones.each do |m|
        %thead
          %tr
            %th
            %th{ :colspan => 4 }
              %a.large{ :href => "https://github.com/#{@gh.user}/#{@gh.repo}/milestones/#{m.number}" }= m.title
              (
              %a.small{ :href => "/pivot?milestone=#{m.number}"} pivot
              )
        %tbody.sortable{ :milestone => m.number }
          - if issues = @by_milestones[m.number]
            - issues.each do |i|
              %tr{ :number => i.number, :milestone => m.number }
                %td
                  %a.tip{ :href => i.html_url, :title => i.body }
                    %strong= "##{i.number}" 
                %td= i.title 
                %td
                  - i.labels.each do |l|
                    %span.label= l.name
                %td= i.assignee.login
                %td= i.state
          - else
            %tr
              %td{ :colspan => 5 }
  .span3
    %h1 Pivot by Milestones
    %form{ :action => '/milestones' }
      %label Labels
      %input{ :name => 'labels', :value => params[:labels] }
      %label Assignee
      %input{ :name => 'assignee', :value => params[:assignee] }
      %label Milestone Number
      %input{ :name => 'milestone', :value => params[:milestone] }
      %label Status
      %select{ :name => 'state' }
        %option{ :value => 'open' } Open
        %option{ :value => 'closed' } Closed

      %br/
      %input.btn.btn-info{ :type => 'submit', :value => 'Filter' }
    %hr
    %a.btn.btn-info{ :href => "/milestones" } Pivot By Labels
    %a.btn.btn-success{ :href => "https://github.com/#{@gh.user}/#{@gh.repo}/issues/new" } New Issue


:javascript
  $(function () { 
    $('.sortable').sortable({ 
      axis: 'y', 
      connectWith: '.sortable',
      stop: change   
    }) 
    $('.tip').tooltip({ placement: 'right' });
  })

  function change(evt, ui) {
    var $ele = $(ui.item);
    var $ul  = $ele.closest('.sortable');
    var mn  = $ul.attr('milestone');

    var issueMN = $ele.attr('milestone');
    var n = $ele.attr('number');
    if (issueMN != mn) {
      $.post('/update-issue', { milestone: mn, number: n }, function () { $ele.attr('milestone', mn); console.log('saved') });
    }
  }
%style
  :sass
    .sortable
      min-height: 30px
